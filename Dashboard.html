<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Map Satellite + Controls + Distance</title>
  <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
  
  <style>
    body { margin:0; padding:0; }
    #map { position:absolute; top:0; bottom:0; width:100%; }

    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Text Label ‡πÅ‡∏ó‡∏ô Popup */
    .custom-text-label {
      background-color: #fff;
      color: #333;
      padding: 3px 6px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
      box-shadow: 0 1px 4px rgba(0,0,0,0.3);
      white-space: nowrap;
      /* ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏à‡∏∏‡∏î‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ */
      transform: translate(0, -15px); /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô/‡∏•‡∏á */
    }
    
    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏°‡∏∏‡∏î‡∏à‡∏∏‡∏î‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÄ‡∏î‡∏¥‡∏° */
    .red-dot-marker {
      width: 10px;
      height: 10px;
      background-color: #FF0000;
      border-radius: 100%;
      border: 1px solid white;
      box-shadow: 0 0 1px rgba(0,0,0,0.5);
    }

    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡πà‡∏≤ Bearing (‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏∏‡∏ô) */
    #bearing-info {
      position: absolute;
      top: 10px;
      left: 10px;
      background-color: rgba(255,255,255,0.8);
      padding: 5px 10px;
      border-radius: 4px;
      font-weight: bold;
      font-size: 14px;
      border: 1px solid #333;
      z-index: 1;
    }
    
    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡πà‡∏≤ Zoom Level */
    #zoom-info {
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: rgba(255,255,255,0.8);
      padding: 5px 10px;
      border-radius: 4px;
      font-weight: bold;
      font-size: 14px;
      border: 1px solid #333;
      z-index: 1;
    }

    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡πà‡∏≤ Distance (‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á) */
    #distance-info {
      position: absolute;
      bottom: 10px;
      left: 10px;
      background-color: rgba(255,255,255,0.8);
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: bold;
      border: 1px solid #333;
      z-index: 1;
      white-space: pre-line;
    }

    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° Reset ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á */
    .reset-button {
      background: white;
      border: none;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      padding: 8px;
      cursor: pointer;
      margin: 5px;
      transition: transform 0.2s, background 0.3s;
    }
    .reset-button:hover {
      background: #f0f0f0;
      transform: scale(1.1);
    }

    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏õ‡∏∏‡πà‡∏° Navigation Control ‡∏Ç‡∏≠‡∏á MapLibre */
    .maplibregl-ctrl-group > button {
      border-radius: 4px !important;
      margin: 2px !important;
      box-shadow: 0 1px 4px rgba(0,0,0,0.2);
      transition: transform 0.15s, background-color 0.2s;
    }
    .maplibregl-ctrl-group > button:hover {
      background-color: #f0f0f0;
      transform: scale(1.1);
    }
  </style>
</head>
<body>

<div id="map"></div>

<div id="bearing-info">Bearing: -45.60¬∞</div>

<div id="zoom-info">Zoom: 15.65</div>

<div id="distance-info">
‡∏û‡∏¥‡∏Å‡∏±‡∏î: 99.535692, 11.231666
‡∏£‡∏∞‡∏¢‡∏∞‡πÑ‡∏õ‡∏Ç‡∏≠‡∏ö‡∏•‡πà‡∏≤‡∏á: [‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì] km 
‡∏£‡∏∞‡∏¢‡∏∞‡πÑ‡∏õ‡∏Ç‡∏≠‡∏ö‡∏ã‡πâ‡∏≤‡∏¢: [‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì] km
</div>

<script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>

<script>
  // =======================================================
  // 1. ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô (Initial Setup)
  // =======================================================
  
  // üéØ ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏´‡∏°‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡∏à‡∏∏‡∏î‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á
  const targetLngLat = [99.535692, 11.231666]; 

  // üìê ‡∏Ñ‡πà‡∏≤‡∏ä‡∏î‡πÄ‡∏ä‡∏¢ (Offset) ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ó‡∏µ‡πà‡∏´‡∏°‡∏∏‡∏ô‡πÅ‡∏•‡πâ‡∏ß
  const desiredOffsetSouth = 0.0010;
  const desiredOffsetWest  = 0.0000;

  // ‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
  const initialBearing = -45.6;          
  const initialZoom = 15.65;
  const initialPitch = 0;                

  // --- ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Offset ‡∏ï‡∏≤‡∏°‡∏°‡∏∏‡∏°‡∏´‡∏°‡∏∏‡∏ô (Trigonometry) ---
  const angleRad = (initialBearing * Math.PI) / 180; 

  const offsetX_Lng = (
      (desiredOffsetWest * Math.cos(angleRad)) + 
      (desiredOffsetSouth * Math.sin(angleRad))
  );

  const offsetY_Lat = (
      (desiredOffsetSouth * Math.cos(angleRad)) - 
      (desiredOffsetWest * Math.sin(angleRad))
  );

  const center = [
      targetLngLat[0] - offsetX_Lng, 
      targetLngLat[1] - offsetY_Lat  
  ];
  // -------------------------------------------------

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡πá‡∏≠‡∏ö‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà (Map Object)
  const map = new maplibregl.Map({
    container: 'map', 
    style: {
      version: 8,
      sources: {
        satellite: {
          type: 'raster',
          tiles: [
            'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'
          ],
          tileSize: 256
        }
      },
      layers: [
        { id: 'satellite', type: 'raster', source: 'satellite' }
      ]
    },
    center: center, 
    zoom: initialZoom,
    bearing: initialBearing,
    pitch: initialPitch,
    maxZoom: 17.39
  });


  // =======================================================
  // 2. ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° (Controls) ‡πÅ‡∏•‡∏∞ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
  // =======================================================

  // ‡πÄ‡∏û‡∏¥‡πà‡∏° Navigation Control
  map.addControl(new maplibregl.NavigationControl({ visualizePitch: true }), 'bottom-right');

  // ‡∏Ñ‡∏•‡∏≤‡∏™ Reset Control (‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏á)
  class ResetControl {
    onAdd(map) {
      this.map = map;
      this.container = document.createElement('div');
      this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';

      const btn = document.createElement('button');
      btn.className = 'reset-button';
      btn.innerHTML = "‚ü≥";
      btn.title = "Reset View";
      btn.onclick = () => {
        map.easeTo({
          center: center, 
          zoom: initialZoom,
          bearing: initialBearing,
          pitch: initialPitch
        });
      };

      this.container.appendChild(btn);
      return this.container;
    }
    onRemove() {
      this.container.parentNode.removeChild(this.container);
      this.map = undefined;
    }
  }
  map.addControl(new ResetControl(), 'bottom-right');


  // =======================================================
  // 3. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Bearing (‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏∏‡∏ô) & Zoom
  // =======================================================
  const bearingInfo = document.getElementById('bearing-info');
  const zoomInfo = document.getElementById('zoom-info');

  function updateBearing() {
    const bearing = map.getBearing().toFixed(2);
    bearingInfo.innerText = `Bearing: ${bearing}¬∞`;
  }
  function updateZoom() {
    const zoom = map.getZoom().toFixed(2); 
    zoomInfo.innerText = `Zoom: ${zoom}`;
  }
  map.on('rotate', updateBearing);
  map.on('zoom', updateZoom);
  map.on('load', updateBearing); 
  map.on('load', updateZoom); 


  // =======================================================
  // 4. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Distance (‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏Ç‡∏≠‡∏ö‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà)
  // =======================================================
  const distanceInfo = document.getElementById('distance-info');
  const targetPoint = targetLngLat; 

  function updateDistances() {
    const bounds = map.getBounds(); 
    const point = turf.point(targetPoint); 

    const south = turf.point([targetPoint[0], bounds.getSouth()]); 
    const west  = turf.point([bounds.getWest(), targetPoint[1]]);  

    const distSouth = turf.distance(point, south, {units: 'kilometers'}).toFixed(2);
    const distWest  = turf.distance(point, west,  {units: 'kilometers'}).toFixed(2);
    
    distanceInfo.innerText =
      `‡∏û‡∏¥‡∏Å‡∏±‡∏î: ${targetPoint[0]}, ${targetPoint[1]}\n` +
      `‡∏£‡∏∞‡∏¢‡∏∞‡πÑ‡∏õ‡∏Ç‡∏≠‡∏ö‡∏•‡πà‡∏≤‡∏á: ${distSouth} km\n` +
      `‡∏£‡∏∞‡∏¢‡∏∞‡πÑ‡∏õ‡∏Ç‡∏≠‡∏ö‡∏ã‡πâ‡∏≤‡∏¢: ${distWest} km`;
  }

  map.on('moveend', updateDistances);
  map.on('load', updateDistances); 


  // =======================================================
  // 5. Marker ‡πÅ‡∏•‡∏∞ Text Label (‡πÅ‡∏ó‡∏ô Popup)
  // =======================================================
  const markerPoint = targetLngLat; 

  // --- 5.1 Marker ‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà 1: ‡∏à‡∏∏‡∏î‡∏™‡∏µ‡πÅ‡∏î‡∏á (‡∏´‡∏°‡∏∏‡∏î‡∏´‡∏•‡∏±‡∏Å) ---
  const markerDiv = document.createElement('div');
  markerDiv.className = 'red-dot-marker'; 

  const marker = new maplibregl.Marker({
    element: markerDiv,
    anchor: 'center'
  })
  .setLngLat(markerPoint)
  .addTo(map);

  // --- 5.2 Marker ‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà 2: Text Label (‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ó‡∏ô Popup) ---
  const labelDiv = document.createElement('div');
  labelDiv.className = 'custom-text-label'; 
  labelDiv.innerText = "‡∏´‡∏°‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô"; 

  const labelMarker = new maplibregl.Marker({
    element: labelDiv,
    anchor: 'bottom' 
  })
  .setLngLat(markerPoint)
  .addTo(map);

</script>

</body>
</html>
