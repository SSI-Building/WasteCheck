<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Waste Bag Dashboard - ตัวอย่าง</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --bg:#f6f8f9;
      --card:#ffffff;
      --accent:#0a6847;
      --muted:#6b7280;
    }
    body{
      margin:0;
      font-family: "Segoe UI", Roboto, "Noto Sans Thai", sans-serif;
      background:var(--bg);
      color:#111827;
    }
    .container{
      max-width:1200px;
      margin:20px auto;
      padding:18px;
    }
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:16px;
    }
    header h1{
      margin:0;
      font-size:20px;
      color:var(--accent);
    }
    .controls{
      display:flex;
      gap:8px;
      align-items:center;
    }
    .controls input[type="date"]{padding:6px 8px;border-radius:6px;border:1px solid #ddd;}
    .btn{
      background:var(--accent);
      color:white;
      border:none;
      padding:8px 10px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
    }
    .kpi{
      display:grid;
      grid-template-columns:repeat(5,1fr);
      gap:12px;
      margin-bottom:18px;
    }
    .card{
      background:var(--card);
      border-radius:10px;
      padding:12px;
      box-shadow:0 6px 18px rgba(10,10,10,0.04);
    }
    .card .title{font-size:13px;color:var(--muted);margin-bottom:6px;}
    .card .value{font-size:20px;font-weight:700;color:#111827;}
    .grid-two{
      display:grid;
      grid-template-columns: 1fr 420px;
      gap:16px;
      margin-bottom:16px;
    }
    .chart-wrap{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(10,10,10,0.04);}
    canvas{width:100% !important;height:320px !important;}
    table{
      width:100%;
      border-collapse:collapse;
      font-size:13px;
    }
    thead th{
      text-align:left;
      padding:8px;
      background:#f3f4f6;
      border-bottom:1px solid #e5e7eb;
    }
    tbody td{
      padding:8px;
      border-bottom:1px solid #eee;
    }
    .table-container{
      background:var(--card);
      border-radius:10px;
      padding:8px;
      box-shadow:0 6px 18px rgba(10,10,10,0.04);
      overflow:auto;
      max-height:420px;
    }
    .tools{
      display:flex;
      gap:8px;
      margin-bottom:8px;
      align-items:center;
    }
    .search{
      padding:8px 10px;
      border-radius:8px;
      border:1px solid #ddd;
      min-width:220px;
    }
    @media(max-width:980px){
      .kpi{grid-template-columns:repeat(2,1fr);}
      .grid-two{grid-template-columns:1fr;}
      canvas{height:260px !important;}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>WasteCheck Analytics — ตัวอย่าง</h1>
      <div class="controls">
        <label for="filterDate">กรองวันที่:</label>
        <input type="date" id="filterDate" />
        <button class="btn" id="resetBtn">รีเซ็ต</button>
        <button class="btn" id="exportBtn">Export CSV</button>
      </div>
    </header>

    <!-- KPI -->
    <section class="kpi" aria-label="KPI summary">
      <div class="card">
        <div class="title">ถุงแดงรวม</div>
        <div class="value" id="totalRed">0</div>
      </div>
      <div class="card">
        <div class="title">ถุงเขียวรวม</div>
        <div class="value" id="totalGreen">0</div>
      </div>
      <div class="card">
        <div class="title">ถุงดำรวม</div>
        <div class="value" id="totalBlack">0</div>
      </div>
      <div class="card">
        <div class="title">ถุงใส่เศษอาหารรวม</div>
        <div class="value" id="totalFood">0</div>
      </div>
      <div class="card">
        <div class="title">จำนวนจุดที่บันทึก</div>
        <div class="value" id="totalLocations">0</div>
      </div>
    </section>

    <!-- Charts -->
    <section class="grid-two">
      <div class="chart-wrap">
        <canvas id="barChart"></canvas>
      </div>

      <div style="display:flex;flex-direction:column;gap:12px;">
        <div class="chart-wrap">
          <canvas id="pieChart"></canvas>
        </div>
        <div class="card" style="padding:10px;">
          <strong>คำอธิบาย</strong>
          <p style="margin:6px 0 0 0;color:var(--muted);font-size:13px;">
            แสดงข้อมูลตัวอย่างที่คุณให้: สามารถกรองตามวันที่ ตัด-ต่อโค้ดให้ง่ายต่อการต่อยอด เช่นเชื่อม API หรือ Google Sheets
          </p>
        </div>
      </div>
    </section>

    <!-- Table -->
    <div class="table-container" style="margin-top:12px;">
      <div class="tools" style="justify-content:space-between;">
        <div style="display:flex;gap:8px;align-items:center;">
          <input class="search" id="searchInput" placeholder="ค้นหาชื่อพื้นที่..." />
          <select id="bagFilter" style="padding:8px;border-radius:8px;border:1px solid #ddd;">
            <option value="">-- แสดงทุกประเภทถุง --</option>
            <option value="red">ถุงแดง &gt; 0</option>
            <option value="green">ถุงเขียว &gt; 0</option>
            <option value="black">ถุงดำ &gt; 0</option>
            <option value="food">ถุงอาหาร &gt; 0</option>
          </select>
        </div>
        <div style="color:var(--muted);font-size:13px;">แสดงข้อมูลตัวอย่างแถว: <span id="rowsCount">0</span></div>
      </div>

      <table id="dataTable">
        <thead>
          <tr>
            <th>หมายเลข</th>
            <th>พื้นที่</th>
            <th>ถุงแดง</th>
            <th>ถุงเขียว</th>
            <th>ถุงดำ</th>
            <th>ถุงอาหาร</th>
            <th>วันที่</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    // ====== ข้อมูลตัวอย่าง (จากที่คุณให้) ======
    const rawData = [
      {id:1, area:"โรงจอดรถด้านหน้าป้อม", red:2, green:1, black:1, food:1, datetime:"2025-12-02"},
      {id:2, area:"ป้อมข้างห้องน้ำ", red:1, green:0, black:0, food:1, datetime:"2025-12-02"},
      {id:3, area:"ออฟฟิสหน้า SSI", red:1, green:2, black:2, food:1, datetime:"2025-12-02"},
      {id:4, area:"ซุ้มศาลาพักผ่อนทางเดินไป Canteen", red:0, green:1, black:1, food:0, datetime:"2025-12-02"},
      {id:5, area:"ด้านข้าง Canteen-หน้าห้องน้ำ Canteen", red:2, green:1, black:1, food:1, datetime:"2025-12-02"},
      {id:6, area:"ด้านข้าง Canteen-ฝั่งซุ่มกระดังงา1", red:0, green:0, black:1, food:5, datetime:"2025-12-02"},
      {id:7, area:"ออดิทรอเดียม", red:1, green:2, black:1, food:1, datetime:"2025-12-02"},
      {id:8, area:"หลังออดิ Lab หลังงาน", red:1, green:0, black:1, food:1, datetime:"2025-12-02"},
      {id:9, area:"ข้าง Fire Station", red:1, green:1, black:2, food:3, datetime:"2025-12-02"},
      {id:10, area:"ป้อม รปภ.104-TCS", red:0, green:0, black:1, food:1, datetime:"2025-12-02"},
      {id:11, area:"Office Slab Yard", red:1, green:0, black:1, food:1, datetime:"2025-12-02"},
      {id:12, area:"หน้า Store Room M1", red:0, green:0, black:1, food:1, datetime:"2025-12-02"},
      {id:13, area:"จุดข้างห้องน้ำทำเนียบขาว", red:2, green:0, black:0, food:0, datetime:"2025-12-02"},
      {id:14, area:"ประตูทางออกไป WTP", red:0, green:2, black:1, food:0, datetime:"2025-12-02"},
      {id:15, area:"หน้าห้อง MMD ข้าง Line ผลิด HSM Level 6.5", red:0, green:0, black:1, food:1, datetime:"2025-12-02"},
      {id:16, area:"ข้าง RM Pulpit", red:3, green:0, black:0, food:0, datetime:"2025-12-02"},
      // ID 17 appears twice in your data - we keep both as separate records
      {id:17, area:"Roll shop HSM", red:1, green:2, black:3, food:4, datetime:"2025-12-02"},
      {id:17, area:"Roll shop HSM", red:1, green:2, black:3, food:4, datetime:"2025-12-02"},
      {id:18, area:"Roll shop HSM ข้างห้อง Canteen RSH/ข้างห้องน้ำ RSH", red:1, green:2, black:3, food:4, datetime:"2025-12-02"},
      {id:19, area:"หน้า Donw Coiler Pulpit หน้าห้อง Pulpit DC", red:1, green:2, black:3, food:4, datetime:"2025-12-02"},
      {id:20, area:"ประตู Motor Room(ทางด่วน) ประตูทางออก Ramp Level 6.5", red:1, green:2, black:3, food:4, datetime:"2025-12-02"},
      {id:21, area:"ห้อง Mortor Room ห้อง Automation Pulpit Level 6.5", red:1, green:2, black:3, food:4, datetime:"2025-12-02"},
      {id:22, area:"Discharging Pulpit", red:1, green:2, black:3, food:4, datetime:"2025-12-02"},
      {id:23, area:"WTP-บ่อสแกล", red:1, green:2, black:3, food:4, datetime:"2025-12-02"},
      {id:24, area:"SK#1", red:1, green:2, black:3, food:4, datetime:"2025-12-02"},
      {id:25, area:"SK#3 ด้านหน้า ห้องน้ำ", red:1, green:2, black:3, food:4, datetime:"2025-12-02"},
      {id:26, area:"หน้า WHO", red:1, green:2, black:3, food:4, datetime:"2025-12-02"},
      {id:27, area:"ER Work Shop", red:1, green:2, black:3, food:4, datetime:"2025-12-02"},
      {id:28, area:"SK#2 ชั้นบน", red:1, green:2, black:3, food:4, datetime:"2025-12-02"},
      {id:29, area:"ป้อม 105 ข้าง TCS", red:1, green:2, black:3, food:4, datetime:"2025-12-02"},
      {id:30, area:"ป้อม รปภ. 103-WCE", red:1, green:2, black:3, food:4, datetime:"2025-12-02"},
      {id:31, area:"Office POP", red:1, green:2, black:3, food:4, datetime:"2025-12-02"},
      {id:32, area:"กระดาษห่อ Coil PO", red:1, green:2, black:3, food:4, datetime:"2025-12-02"},
      {id:33, area:"Office CYS ชั้น1 ข้างห้องน้ำชั้น 1", red:1, green:2, black:3, food:4, datetime:"2025-12-02"},
      {id:34, area:"อินเซ่ไฟฟ้า", red:1, green:2, black:3, food:4, datetime:"2025-12-02"},
      {id:35, area:"อาคาร Wase Area", red:1, green:2, black:3, food:4, datetime:"2025-12-02"},
      {id:36, area:"บริเวณจุดพักพนักงาน Cleaning", red:1, green:2, black:3, food:4, datetime:"2025-12-02"},
      {id:37, area:"พื้นที่รับน้ำมันเตา", red:1, green:2, black:3, food:4, datetime:"2025-12-02"}
    ];

    // ====== Helpers ======
    function formatNumber(n){ return Number(n).toLocaleString('en-US'); }

    // ====== Global state ======
    let filteredData = [...rawData];

    // ====== Compute KPIs and render table ======
    function computeAndRender(data){
      // totals
      const totals = data.reduce((acc,row) => {
        acc.red += Number(row.red || 0);
        acc.green += Number(row.green || 0);
        acc.black += Number(row.black || 0);
        acc.food += Number(row.food || 0);
        return acc;
      }, {red:0, green:0, black:0, food:0});

      document.getElementById('totalRed').innerText = formatNumber(totals.red);
      document.getElementById('totalGreen').innerText = formatNumber(totals.green);
      document.getElementById('totalBlack').innerText = formatNumber(totals.black);
      document.getElementById('totalFood').innerText = formatNumber(totals.food);
      document.getElementById('totalLocations').innerText = data.length;

      // render table
      const tbody = document.querySelector('#dataTable tbody');
      tbody.innerHTML = '';
      data.forEach(r => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${r.id}</td>
          <td>${r.area}</td>
          <td>${r.red}</td>
          <td>${r.green}</td>
          <td>${r.black}</td>
          <td>${r.food}</td>
          <td>${r.datetime}</td>
        `;
        tbody.appendChild(tr);
      });

      document.getElementById('rowsCount').innerText = data.length;

      // update charts
      updateCharts(data, totals);
    }

    // ====== Charts ======
    let pieChart, barChart;

    function createCharts(){
      const ctxPie = document.getElementById('pieChart').getContext('2d');
      pieChart = new Chart(ctxPie, {
        type: 'pie',
        data: {
          labels: ['ถุงแดง','ถุงเขียว','ถุงดำ','ถุงอาหาร'],
          datasets: [{
            data: [0,0,0,0],
            backgroundColor: ['#ef4444','#10b981','#111827','#f59e0b'],
            borderColor: '#fff',
            borderWidth: 1
          }]
        },
        options: {
          plugins:{
            legend:{position:'bottom'}
          }
        }
      });

      const ctxBar = document.getElementById('barChart').getContext('2d');
      barChart = new Chart(ctxBar, {
        type: 'bar',
        data: {
          labels: [],
          datasets: [
            { label:'ถุงแดง', data:[], stack:'stack1', backgroundColor:'#ef4444' },
            { label:'ถุงเขียว', data:[], stack:'stack1', backgroundColor:'#10b981' },
            { label:'ถุงดำ', data:[], stack:'stack1', backgroundColor:'#111827' },
            { label:'ถุงอาหาร', data:[], stack:'stack1', backgroundColor:'#f59e0b' }
          ]
        },
        options: {
          responsive:true,
          scales: {
            x: { stacked: true, ticks:{maxRotation:40,minRotation:0} },
            y: { stacked: true, beginAtZero:true }
          },
          plugins:{legend:{position:'bottom'}}
        }
      });
    }

    function updateCharts(data, totals){
      // pie
      pieChart.data.datasets[0].data = [totals.red, totals.green, totals.black, totals.food];
      pieChart.update();

      // bar (per area)
      const labels = data.map(r => r.area);
      const redData = data.map(r => r.red);
      const greenData = data.map(r => r.green);
      const blackData = data.map(r => r.black);
      const foodData = data.map(r => r.food);

      barChart.data.labels = labels;
      barChart.data.datasets[0].data = redData;
      barChart.data.datasets[1].data = greenData;
      barChart.data.datasets[2].data = blackData;
      barChart.data.datasets[3].data = foodData;
      barChart.update();
    }

    // ====== Filtering & Search ======
    function applyFilters(){
      const dateVal = document.getElementById('filterDate').value;
      const search = document.getElementById('searchInput').value.trim().toLowerCase();
      const bagFilter = document.getElementById('bagFilter').value;

      filteredData = rawData.filter(r => {
        if(dateVal){
          // raw data dates are "2025-12-02"
          if(r.datetime !== dateVal) return false;
        }
        if(search){
          if(!r.area.toLowerCase().includes(search)) return false;
        }
        if(bagFilter){
          if(bagFilter === 'red' && !(Number(r.red) > 0)) return false;
          if(bagFilter === 'green' && !(Number(r.green) > 0)) return false;
          if(bagFilter === 'black' && !(Number(r.black) > 0)) return false;
          if(bagFilter === 'food' && !(Number(r.food) > 0)) return false;
        }
        return true;
      });

      computeAndRender(filteredData);
    }

    // ====== Export CSV ======
    function exportCSV(){
      const rows = [
        ['หมายเลข','พื้นที่','ถุงแดง','ถุงเขียว','ถุงดำ','ถุงอาหาร','วันที่']
      ];
      filteredData.forEach(r => {
        rows.push([r.id, r.area, r.red, r.green, r.black, r.food, r.datetime]);
      });
      const csvContent = rows.map(r => r.map(c => `"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob = new Blob([csvContent], {type: 'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `wastebags_export_${new Date().toISOString().slice(0,10)}.csv`;
      a.click();
      URL.revokeObjectURL(url);
    }

    // ====== Init ======
    window.addEventListener('DOMContentLoaded', () => {
      // set default date (first record date)
      const firstDate = rawData.length ? rawData[0].datetime : '';
      document.getElementById('filterDate').value = firstDate;

      createCharts();
      applyFilters();

      // listeners
      document.getElementById('filterDate').addEventListener('change', applyFilters);
      document.getElementById('searchInput').addEventListener('input', () => {
        // small debounce
        clearTimeout(window._searchT);
        window._searchT = setTimeout(applyFilters, 200);
      });
      document.getElementById('bagFilter').addEventListener('change', applyFilters);
      document.getElementById('exportBtn').addEventListener('click', exportCSV);
      document.getElementById('resetBtn').addEventListener('click', () => {
        document.getElementById('filterDate').value = '';
        document.getElementById('searchInput').value = '';
        document.getElementById('bagFilter').value = '';
        applyFilters();
      });
    });
  </script>
</body>
</html>
